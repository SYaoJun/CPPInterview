# MySQL
- 关系型数据库
### 参考书籍
- 《MySQL技术内幕：InnoDB存储引擎》
### myISAM和InnoDB的区别
- InnoDB引擎：
  1. 支持事务
  2. 行锁（适合高并发）
  3. 支持外键
  4. MySQL 5.5版本后的默认存储引擎
- MyISAM引擎：
  1. 不支持事务
  2. 不支持外键
  3. 支持表锁。优势是访问的速度快。
  4. MySQL 5.5版本前的默认存储引擎。
  5. myISAM索引文件和数据文件是分离的，查询较多的更新较少的情况下优先使用。

### Clustered Index 聚集索引
- 聚集索引，又称为主键索引。
- InnoDB是索引组织表，表中数据按照主键顺序存放。
- 聚集索引是按照每张表的主键，构造一颗B+树，同时叶子节点中存放的即为整张表的行记录数据，也将聚集索引的叶子节点称为数据页data page。
- 每张表只能拥有一个聚集索引。
### Secondary Index 辅助索引
- 辅助索引，又称为非聚集索引，或者二级索引。
- 辅助索引是指叶子节点并不包含行记录的全部数据。
- 聚集索引和辅助索引的区别在于叶子几点存放的是否是一整行的信息。
- 所有辅助索引的叶子节点都引用主键索引，过长的主索引会使得辅助索引变得过大。
- 唯一索引，普通索引，前缀索引都是二级索引
> 思考：为什么辅助索引叶子节点不直接存行记录的指针，而要存主键索引的值？
### Undo log
1. 用于恢复已提交事务修改的页操作。
2. 物理日志。
3. 用来保证事务的原子性和持久性。
4. 在disk。
### Redo log
1. 回滚行记录到某个特定版本。
2. 逻辑日志。
3. 用来保证事务的一致性。
4. 在memory。
### redo log
- commit的时候，刷新脏页到缓冲池，而不是刷到磁盘，借助redo log保证变更持久化。
- 记录数据的逻辑修改。
  - 更新buffer pool页里面的数据
  - 生成一个redo log对象
  - commit后，持久化这个redo log对象到磁盘
- 出于事务的考虑以及顺序IO比随机IO效率更高。
- 当达到checkPoint后，即log满了以后，就将数据更新到磁盘上。
- redo log有两个文件，循环写入。

## undo log
- 记录每个操作对应的回滚操作，比如插入一条数据时，就在对应的undo log中记录一条删除命令。
- 每当我们对一条记录做改动insert/delete/update时，都需要把以后回滚的东西记录下来。
- 所有的改动形成一个版本链，版本链的头节点就是当前记录的最新的值。
- undo log删除时机：没有比这个undo log更早的read view时，undo log就会被删除。
### Binlog
1. 操作日志
### MVCC
- 多版本并发控制
### 节点
- 节点大小16k
- 磁盘页4k
- 就地写：在原来存在的位置进行更新
